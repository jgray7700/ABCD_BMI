######NEW ANALYSES FOR R&R######
#Run this after myData has been fully assembled for primary analyses using other syntaxes provided#

###Linear Regression### 
linreg_nocv <- lm(bmiz95 ~ ., data=myData)
linreg_nocv
output <- summary(linreg_nocv)
capture.output(output, file = "Output_linreg_nocv.txt")

###INTERACTION ANALYSES OF ALL VAR###
#Custom Control Parameters; number = number of folds, repeats = numer of complete sets of folds to compute
custom <- trainControl(method = "repeatedcv", number = 10, repeats = 5, verboseIter = T) #cross validation
myData1 <- t(apply(myData, 1, combn, 2, prod))
colnames(myData1) <- paste("Inter.V", combn(1:44, 2, paste, collapse="V"), sep="")
#Remove all columns with bmiz95 (v1) and merge
myData1 <- myData1[, -grep("V1V", colnames(myData1))]
myData_inter <- cbind(myData, myData1)
train1<-myData_inter
#LASSO
lasso <- train(bmiz95 ~ ., train1, method = 'glmnet', tuneGrid = expand.grid(alpha=1, lambda = seq(.00001, 1, length = 5)), trControl = custom)
plot(varImp(lasso), top = 50, lcolor = Orange)
lassocoef <- coef(lasso$finalModel, s = lasso$bestTune$lambda)
lassocoef <- as.matrix(lassocoef)
write.table(lassocoef, "lassoInterCoef.txt")
lasso$bestTune
lasso

###INTERACTION ANALYSES OF 7 DEMO ONLY ((7x36) + (42x7))/2 = 273 interaction vars); this dataset was manually generated by deleting irrelevant columns from the above dataset which had all interactions.###
#V3 = sex, V36 = ethnicity, V37 = marital status; V38 = parent ed; V39 = income; V40 = partner; V41 = White
#NOTE this was manually generated in excel from the above dataset with all interactions.
setwd("G:/")
train2 <- read.csv("ABCD_DemoInteractions.csv")
#LASSO
lasso <- train(bmiz95 ~ ., train2, method = 'glmnet', tuneGrid = expand.grid(alpha=1, lambda = seq(.00001, 1, length = 5)), trControl = custom)
plot(varImp(lasso), top = 70, lcolor = Orange)
lassocoef <- coef(lasso$finalModel, s = lasso$bestTune$lambda)
lassocoef <- as.matrix(lassocoef)
write.table(lassocoef, "lassoDemoInterCoef.txt")
lasso$bestTune
lasso

##RUN ON ALL DATA NO INTERACTIONS JUST TO COMPARE
#LASSO
lasso <- train(bmiz95 ~ ., myData, method = 'glmnet', tuneGrid = expand.grid(alpha=1, lambda = seq(.00001, 1, length = 5)), trControl = custom)
lasso$bestTune
lasso
